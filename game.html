<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>game</title>
<link rel="stylesheet" href="game.css" media="only all and (min-width:320px)">

<script>
var ctx; 
var canvas;
var backCard; 
var card; 
var isPassed = true; //not click  
var backgroundAudio;
var gameOverAudio;
var buttonAudio;
var clickCardAudio;
var bombAudio;
var showAllCardsAudio;
var timer;
var matrix = [];  
//var firstX = 20; 
//var firstY = 100; 
var firstX = 25;
var firstY = 73; 
var margin = 4; 
var cardWidth = 50; 
var cardHeight = 50;
var score=0;
var minuts=0; 
var second=0;
//pause button
var pauseButtonX=50;
var pauseButtonY=420;
var pauseButtonWidth=100;
var pauseButtonHeight=41;
//stop button
var stopButtonX=170;
var stopButtonY=420;
var stopButtonHeight=41;
var stopButtonWidth=100;
var checkAudio;
var status=0;
var pictures = [ 
"image/icon06.png","image/icon06.png",
"image/icon06.png","image/icon06.png",
"image/icon06.png","image/icon06.png",
"image/iconbomb0.png","image/icon06.png",
"image/icon06.png","image/icon06.png",
"image/icon06.png","image/icon06.png",
"image/icon06.png","image/icon06.png",
"image/icon06.png","image/icon06.png",
"image/icon06.png","image/icon06.png",
"image/icon06.png","image/icon06.png",
"image/icon06.png","image/icon06.png",
"image/icon06.png","image/icon06.png",
"image/icon06.png","image/icon06.png",
"image/icon06.png","image/icon06.png",
"image/icon06.png","image/icon06.png",
]; 

//draw cards' back sides
function backsideCard() 
{ 
ctx.drawImage(backCard, this.x,this.y, this.width, this.height);
}

 
//construction-for cards
function Cards(x, y, width, height,img, info,bomb){
	this.x=x;
	this.y=y;
	this.width=width;
	this.height=height;
	this.img=img;
	this.bomb=bomb;
	this.info=info;
	this.draw = backsideCard; 
}

//make matrix for cards, set up cards objects
function make_matrix(){
	var pic;
	var cardX=firstX;
	var cardY=firstY;
	
	for(var i=0;i<pictures.length;i++){
		pic = new Image();
		pic.src=pictures[i];
		bomb=0;
		if(i==6){var bomb=1;}
		card=new Cards(cardX,cardY,cardWidth,cardHeight,pic,i,bomb);
		matrix.push(card);

		cardX = cardX + cardWidth + margin;
		if(i%5==4){
			cardX=firstX;
			cardY=cardY + cardHeight + margin;
			}
			
		card.draw();
		}
	
	}
function shuffle() 
{ 
var i; 
var j; 
var temp_info; 
var temp_img; 
var temp_bomb;
var matrix_length = matrix.length; 
var k; 
for (k = 0; k < 3 * matrix_length; k++) 
{ 
i = Math.floor(Math.random() * matrix_length); 
j = Math.floor(Math.random() * matrix_length); 
temp_info = matrix[i].info; 
temp_img = matrix[i].img; 
temp_bomb= matrix[i].bomb;
matrix[i].info = matrix[j].info; 
matrix[i].img = matrix[j].img; 
matrix[i].bomb = matrix[j].bomb;
matrix[j].info = temp_info; 
matrix[j].img = temp_img; 
matrix[j].bomb = temp_bomb; 
} 
} 
//click card method triggered by mouse event
function clickCard(ev) 
{ 

var mx; 
var my; 

var i; 

if (ev.layerX || ev.layerX == 0) { // Firefox 
mx = ev.layerX; 
my = ev.layerY; 
} else if (ev.offsetX || ev.offsetX == 0) { // Opera 
mx = ev.offsetX; 
my = ev.offsetY; 
} 

for (i = 0; i < matrix.length; i++) 
{ 
	card = matrix[i]; 
		//find which card the player click
		if (mx > card.x && mx < (card.x + card.width) && my > card.y && my < (card.y + card.height)) 
		{ 
			ctx.drawImage(card.img, card.x, card.y, card.width, card.height);
			if (card.bomb==1){
			bombAudio.play();
			}else{
			clickCardAudio.play();}
				break;
		}
} 

if (i < matrix.length) 
{ //the card is bomb
	if (card.bomb==1) 
	{ isPassed=false;
	gameOver(isPassed);
	} 
} 
//find the pause button
if (mx > pauseButtonX && mx < (pauseButtonX + pauseButtonWidth) && my > pauseButtonY && my < (pauseButtonY + pauseButtonHeight)) 
{ 	buttonAudio.play();
	document.getElementById('pause').style.display = "block";
	clearInterval(timer);
}
//find the stop button
if (mx > stopButtonX && mx < (stopButtonX + stopButtonWidth) && my > stopButtonY && my < (stopButtonY + stopButtonHeight)) 
{   buttonAudio.play();
	document.getElementById('stop').style.display = "block";
	clearInterval(timer);
}
} 

//onload function
function drawMap(){
	canvas = document.getElementById("myCav");
	ctx = canvas.getContext("2d");

	render();

	//background audio
	backgroundAudio = new Audio("sounds/gamingBg.wav");
	backgroundAudio.loop = true;
	backgroundAudio.volume = .25;
	backgroundAudio.load();
	backgroundAudio.play();
	//gameover audio
	gameOverAudio = new Audio("sounds/gameOver.mp3");
	gameOverAudio.loop = false;
	gameOverAudio.volume = .25;
	gameOverAudio.load();
	//click cards audio
	clickCardAudio = new Audio("sounds/flipCard.wav");
	clickCardAudio.loop = false;
	clickCardAudio.volume = 1;
	clickCardAudio.load();
	//bomb audio
	bombAudio = new Audio("sounds/bomb.wav");
	bombAudio.loop = false;
	bombAudio.volume = .55;
	bombAudio.load();
	//click button audio
	buttonAudio = new Audio("sounds/buttonClick.mp3");
	buttonAudio.loop = false;
	buttonAudio.volume = .55;
	buttonAudio.load();
	//automatically show all cards audio
	showAllCardsAudio = new Audio("sounds/autoShowFrontside.wav");
	showAllCardsAudio.loop = false;
	showAllCardsAudio.volume = .55;
	showAllCardsAudio.load();
	//check all audio
	checkAudio = setInterval(function(){checkReadyState();},1000);
}
function checkReadyState() {
	if (gameOverAudio.readyState == 4 && backgroundAudio.readyState == 4 && showAllCardsAudio.readyState == 4&& clickCardAudio.readyState == 4&& bombAudio.readyState == 4&& backgroundImage.complete&&backCard.complete) {
		checkAudio=clearInterval(checkAudio);
		document.getElementById('loading').style.display = "none";
    //click listener
	setTimeout(function() {
	canvas.addEventListener('click', clickCard, false);	},3500);
	
	make_matrix();
	shuffle();
	
	//automatically show front-side after 1.5 seconds
	setTimeout(function() {
		for (i = 0; i < matrix.length; i++){
		
			ctx.drawImage(matrix[i].img, matrix[i].x, matrix[i].y, matrix[i].width, matrix[i].height);
			showAllCardsAudio.play();
			}
         
    }, 1500);
	//automatically show back-side after 3.5 seconds
	setTimeout(function() {
		for (i = 0; i < matrix.length; i++){
			matrix[i].draw();
			showAllCardsAudio.play();
			}   
    }, 3500);
	
	}
	
	
}

function main(){
	update();
	render();	
	requestAnimationFrame(main);
}
//timer
function update(){

	setTimeout(function() {
			timer=setInterval(function(){
				second++;
				if(second==60){
				minuts++;
				second=0;
				}
				//ctx.clearRect(190,30,120,30);
				//ctx.fillText("Time:"+minuts+":"+second,200, 30);
				document.getElementById('timer').innerHTML = minuts+":"+second;
			},1000);
         
    }, 3500);
}

// Cross-browser support for requestAnimationFrame

requestAnimationFrame = window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.msRequestAnimationFrame || window.mozRequestAnimationFrame;

//automatically update the score and timer
main();

function render(){
	//background image;
    backgroundImage=new Image();
	backgroundImage.src="image/background0.png";
	ctx.drawImage(backgroundImage, 0, 0);
	
	//level background shadow
	backgroundLevel=new Image();
	backgroundLevel.src="image/gameLevel.png";
	ctx.drawImage(backgroundLevel, 0, 0);
	
	//game background shadow
	backgroundShadow=new Image();
	backgroundShadow.src="image/gameBackground.png";
	ctx.drawImage(backgroundShadow, 0, 55);
	//backSide of cards
	backCard=new Image();
    backCard.src="image/back01.png";
	//
	//game title
	ctx.font = "18px Comic Sans MS";
	ctx.fillStyle = "blue";
	ctx.textAlign = "center";
	ctx.textBaseline = "top";
	ctx.fillText("Level 1/10", canvas.width/2, 0);
	//ctx.textAlign = "left";
	//ctx.fillText("Score:"+score, 0, 30);
	//ctx.textAlign = "left";
	//ctx.fillText("Time:"+minuts+":"+second,200, 30);
	
	//pause button
	 pauseButton=new Image();
	pauseButton.src="image/pauseButton.png";
	ctx.drawImage(pauseButton, pauseButtonX, pauseButtonY);
	
	//stop button
	 stopButton=new Image();
	stopButton.src="image/stopButton.png";
	ctx.drawImage(stopButton, stopButtonX, stopButtonY);
	}
function gameOver(isPassed) {
if(!isPassed){
//window.location.href="gameOver.html?scores="+score;
        //backgroundAudio.pause();
        //gameOverAudio.currentTime = 0;
		//gameOverAudio.play();
		setTimeout(function() {
		backgroundAudio.pause();
		gameOverAudio.currentTime = 0;
		gameOverAudio.play();
		document.getElementById('gameOver').style.display = "block";
		},500);
		clearInterval(timer);
}
//var tipsText = isPassed ? 'GAME PASS!' : 'GAME OVER!';
//ctx.fillStyle = Color.mask;
//ctx.fillRect(0, 0, canvas.width, canvas.height);
//ctx.fillStyle = Color.btnBg;
//ctx.fillRect(canvas.width/2-Config.btnWidth/2, //canvas.height/2-Config.btnHeight/2, Config.btnWidth, Config.btnHeight);

//ctx.font = '20px Arial';
//ctx.textAlign = 'center';
//ctx.textBaseline = 'middle';
//ctx.fillStyle = Color.btnFont;
//ctx.fillText('play again', canvas.width/2, canvas.height/2+20);
//ctx.fillText('play again', canvas.width/2, canvas.height/2+Config.btnHeight/2-20);
//ctx.fillStyle = Color.overFont;
//ctx.fillStyle = "white";
//ctx.textBaseline = "top";
//ctx.fillText(tipsText, canvas.width/2, canvas.height/2);
//ctx.fillText(tipsText, canvas.width/2, canvas.height/2-Config.btnHeight);
}

</script>
</head>

<body onload="drawMap()">

<canvas id="myCav" width="320" height="480"
style="border:1px solid #c3c3c3;">
Your browser does not support the canvas element.
</canvas>

<div id="images">
<img src="image/back01.png" width="50" height="50" id="bomb" style="left:100px;top:100px;">
<img src="image/background0.png" width="320" height="480" id="backgroundImage" style="left:100px;top:100px;">
<img src="image/gameScoreTime.png" width="30" height="30">
<img src="image/gameBackground.png" width="320" height="480" id="backgroundImage" style="left:100px;top:100px;">
<img src="image/pauseButton.png" width="25" height="30" id="backgroundImage" style="left:100px;top:100px;"><!---->
<img src="image/stopButton.png" width="25" height="30" id="backgroundImage" style="left:100px;top:100px;">
</div>

<div class="timer">Time: <span id="timer">0:0</span></div>
<div class="score">Scores: <span id="score">0</span></div>

<div id="gameOver">
<p>GAME OVER<br> <span>Your Scores: <script>document.write(score);</script></span></p>
<a href="#" class="leftButton" onclick="buttonAudio.play();setTimeout(function(){window.location.href='game.html';},500);"><img src="image/restartButton.png" width="100" height="41" ></a>
<a href="#" class="rightButton" onclick="buttonAudio.play();setTimeout(function(){window.location.href='homepage.html';},500);"><img src="image/stopButton.png" width="100" height="41" ></a>
</div>

<div id="pause">
<p>Click play to continue.<br>Click stop to quit the game.</p>
<a href="#" class="leftButton" onclick="buttonAudio.play();document.getElementById('pause').style.display='none';
timer=setInterval(function(){
				second++;
				if(second==60){
				minuts++;
				second=0;
				}
				document.getElementById('timer').innerHTML = minuts+':'+second;
			},1000)"><img src="image/continueButton.gif" width="100" height="41" ></a>
<a href="#" class="rightButton" onclick="buttonAudio.play();document.getElementById('pause').style.display='none'; document.getElementById('stop').style.display = 'block';"><img src="image/stopButton.png" width="100" height="41" ></a>
</div>

<div id="stop">
<p>Are you sure to quit<br> this game?</p>
<a href="#" class="leftButton" onclick="buttonAudio.play();setTimeout(function(){window.location.href='homepage.html';},500);"><img src="image/yesButton.png" width="100" height="41" ></a>
<a href="#" class="rightButton" onclick="buttonAudio.play(); document.getElementById('stop').style.display='none';
timer=setInterval(function(){
				second++;
				if(second==60){
				minuts++;
				second=0;
				}
				document.getElementById('timer').innerHTML = minuts+':'+second;
			},1000)"><img src="image/noButton.png" width="100" height="41" ></a>
</div>


<div class="loading" id="loading">LOADING...<p>Please wait</p></div>

</body>

</html>